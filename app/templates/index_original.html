{% extends "base.html" %}
{% block title %}AI inside me - 요약하기{% endblock %}
{% block content %}

<h2>문장 요약하기</h2>

<div class="card">
  <textarea id="textInput" rows="6" placeholder="요약할 문장을 입력하세요"></textarea>
  <button id="summarizeBtn">요약하기</button>
</div>

<div id="resultBox" class="card" style="display:none; margin-top:20px;">
  <h3>요약 결과</h3>
  <p id="summaryText"></p>
  <button id="copyBtn" onclick="copySummary()">복사하기</button>
</div>

<script>
document.getElementById("summarizeBtn").addEventListener("click", async () => {
  const text = document.getElementById("textInput").value.trim();
  if (!text) {
    alert("요약할 텍스트를 입력하세요!");
    return;
  }

  // 로딩 표시
  const btn = document.getElementById("summarizeBtn");
  btn.disabled = true;
  btn.innerText = "요약 중...";

  try {
    const res = await fetch("/api/summarize", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await res.json();
  if (res.ok) {
    const resultBox = document.getElementById("resultBox");
    document.getElementById("summaryText").innerText = data.summary;

    // fade-in 준비
    resultBox.style.display = "block";
    resultBox.classList.remove("show"); // 초기화
    setTimeout(() => resultBox.classList.add("show"), 10); // 트리거
    } else {
      alert(data.error || "요약 중 오류가 발생했습니다.");
    }
  } catch (err) {
    alert("서버 오류가 발생했습니다.");
    console.error(err);
  }

  // 버튼 복원
  btn.disabled = false;
  btn.innerText = "요약하기";
});
</script>

{% endblock %}
