{% extends "base.html" %}
{% block title %}AI inside me - ìš”ì•½í•˜ê¸°{% endblock %}
{% block content %}

<h2>ë¬¸ì¥ ìš”ì•½í•˜ê¸°</h2>

<div class="card">
  <textarea id="textInput" rows="6" placeholder="ìš”ì•½í•  ë¬¸ì¥ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
  <button id="summarizeBtn">ìš”ì•½í•˜ê¸°</button>
</div>

<!-- âœ… ë¡œë”© í‘œì‹œìš© ìš”ì†Œ -->
<div id="loading" style="display:none; margin-top:10px; text-align:center;">
  <p>ğŸ¤– <span id="dots">ìš”ì•½ ì¤‘ì…ë‹ˆë‹¤</span></p>
</div>

<div id="resultBox" class="card fade-in" style="display:none; margin-top:20px;">
  <h3>ìš”ì•½ ê²°ê³¼</h3>
  <p id="summaryText"></p>
  <button id="copyBtn" onclick="copySummary()">ë³µì‚¬í•˜ê¸°</button>
</div>

<script>
document.getElementById("summarizeBtn").addEventListener("click", async () => {
  const text = document.getElementById("textInput").value.trim();
  if (!text) {
    alert("ìš”ì•½í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
    return;
  }

  const btn = document.getElementById("summarizeBtn");
  const loader = document.getElementById("loading");
  const dots = document.getElementById("dots");
  const resultBox = document.getElementById("resultBox");

  // ì´ˆê¸°í™”
  resultBox.style.display = "none";
  loader.style.display = "block";
  btn.disabled = true;
  btn.innerText = "ìš”ì•½ ì¤‘...";

  // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ (ì  1~3ê°œ ê¹œë¹¡ì„)
  let dotCount = 0;
  const loadingAnim = setInterval(() => {
    dotCount = (dotCount + 1) % 4;
    dots.textContent = "ìš”ì•½ ì¤‘ì…ë‹ˆë‹¤" + ".".repeat(dotCount);
  }, 400);

  try {
    const res = await fetch("/api/summarize", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text })
    });

    const data = await res.json();

    if (res.ok) {
      // ê²°ê³¼ í‘œì‹œ
      document.getElementById("summaryText").innerText = data.summary;
      resultBox.style.display = "block";
      resultBox.classList.remove("show");
      setTimeout(() => resultBox.classList.add("show"), 10);
    } else {
      alert(data.error || "ìš”ì•½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
  } catch (err) {
    alert("ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    console.error(err);
  } finally {
    // ë¡œë”© ì¢…ë£Œ
    clearInterval(loadingAnim);
    loader.style.display = "none";
    btn.disabled = false;
    btn.innerText = "ìš”ì•½í•˜ê¸°";
  }
});
</script>

{% endblock %}
